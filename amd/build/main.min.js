define(["jquery","core/ajax","core/templates","core/str"],(function(e,t,i,n){return{init:function(e,t){this.courseID=e,this.inviteBody=t,this.invites=[],"loading"===document.readyState?document.addEventListener("DOMContentLoaded",this.moveMenuItem.bind(this)):this.moveMenuItem()},moveMenuItem:function(){let e=document.querySelector('li[data-key="inviteusers"] a');if(!e)return;let t=e.cloneNode(!0);t.removeAttribute("role"),t.removeAttribute("tabindex"),t.classList.remove("dropdown-item"),t.classList.add("btn","btn-sm","btn-info","d-flex","align-items-center","ml-3"),t.style.height="fit-content",t.innerHTML='<i class="fa fa-user-plus mr-2"></i> Send invites';let i=document.querySelector(".page-header-headings");i&&i.parentNode.insertBefore(t,i.nextSibling),t.addEventListener("click",(e=>{e.preventDefault(),this.showModal()})),e.addEventListener("click",(e=>{e.preventDefault(),this.showModal()}))},showModal:function(){if(document.getElementById("inviteModal"))return void e("#inviteModal").modal("show");const t={courseID:this.courseID,inviteBody:this.inviteBody};i.render("local_invites/modal",t).done(function(t,n){document.body.insertAdjacentHTML("beforeend",t),i.runTemplateJS(n),e("#inviteModal").modal("show"),this.addModalListeners()}.bind(this)).fail((function(e){console.error("Failed to render template",e)}))},addModalListeners:function(){let e=this,t=document.getElementById("inviteModal"),n=t.querySelector("#userEmails"),o=t.querySelector("#addUser"),d=t.querySelector("#userList");n.addEventListener("input",(function(){""===n.value.trim()?o.disabled=!0:o.disabled=!1})),o.addEventListener("click",(function(t){t.preventDefault();let o=n.value.split(/,|;/);n.value="",n.dispatchEvent(new Event("input")),o.forEach((t=>{if(t=t.trim().toLowerCase(),-1==e.invites.indexOf(t)){const n={name:"John Doe",email:t};i.render("local_invites/userinvite",n).done(function(i,n){e.invites.push(t),e.updateStatus(),d.appendChild(document.createRange().createContextualFragment(i)),d.querySelector("li:last-child .delete-icon").addEventListener("click",(function(){e.invites=e.invites.filter((e=>e!==t)),e.updateStatus(),this.closest("li").remove()}))}.bind(this)).fail((function(e){console.error("Failed to render template",e)}))}}))}))},updateStatus:function(){let e=inviteModal.querySelector("#inviteDetails"),t=inviteModal.querySelector("#inviteUsers");0===this.invites.length?(e.classList.add("hidden"),t.disabled=!0):(e.classList.remove("hidden"),t.disabled=!1)}}}));